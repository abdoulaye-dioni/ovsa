% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/secondstep_mice.R
\name{secondstep_mice}
\alias{secondstep_mice}
\title{Modify MAR imputations to reflect plausible MNAR scenarios (mice version)}
\usage{
secondstep_mice(
  data,
  mardata,
  level_ord_var,
  formula,
  manydelta,
  mean = 0,
  sd = 1,
  seed = NULL,
  verbose = TRUE,
  ...
)
}
\arguments{
\item{data}{A \code{data.frame} containing the original dataset with missing values.}

\item{mardata}{A \code{mids} object (output from \code{mice}) representing MAR imputations.}

\item{level_ord_var}{Integer. Number of levels of the ordinal variable.}

\item{formula}{A model formula for the ordinal regression (e.g., \code{X1.mis ~ Y + X2}).}

\item{manydelta}{Optional. A \code{data.frame} containing adjustment vectors for thresholds. One column per MNAR scenario.}

\item{mean}{Mean of the normal perturbation added to the latent variable (default 0).}

\item{sd}{Standard deviation of the perturbation (default 1).}

\item{seed}{Optional integer for reproducibility.}

\item{verbose}{Logical. If \code{TRUE}, shows progress messages.}

\item{...}{Additional arguments (currently unused).}
}
\value{
A list containing:
\describe{
\item{mnardata}{List of modified datasets under MNAR.}
\item{zetanew}{Adjusted thresholds incorporating \code{manydelta}.}
\item{zetaold}{Original thresholds estimated under MAR.}
}
}
\description{
This function modifies datasets initially imputed under a MAR assumption
using \code{mice}, to create plausible datasets under an MNAR mechanism
by shifting thresholds estimated in an ordinal regression model.
}
\examples{
if (requireNamespace("mice", quietly = TRUE) && requireNamespace("ovsa", quietly = TRUE)) {
  data(simda, package = "ovsa")

  # Simulate MNAR missingness
  simdaNA <- simmnar(
    data = simda,
    Y = "Y",
    ord_var = "X1",
    A = 1,
    probA = 0.6,
    B = 5,
    probB = 0.7
  )

  imputed_mice <- firststep(
    data = simdaNA[, c("Y", "X1.mis", "X2")],
    mi = "mice",
    method = c("logreg", "polr", "polyreg"),
    m = 10,
    printFlag = FALSE
  )

  formula <- "X1.mis.mar ~ Y + X2"
  manydelta <- data.frame(delta1 = c(0, 0, 0, 0),
                           delta2 = c(-2, 1, 0, 3),
                           delta3 = c(1, 0, 0, 2),
                           delta4 = c(-1, 0, 0, -1))
  level_ord_var <- 5

  out <- secondstep_mice(
    data = simdaNA,
    mardata = imputed_mice,
    level_ord_var = level_ord_var,
    formula = formula,
    manydelta = manydelta,
    seed = 123,
    sd=1.5,
    verbose = TRUE
  )

  summary(out$mnardata[[1]])
}
}
