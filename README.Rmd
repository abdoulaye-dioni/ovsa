---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# **ovsa**: (ordinal variable sensitivity analysis)

## Title

**ovsa**: (ordinal variable sensitivity analysis)

## Description

The goal of the `ovsa` package is to perform sensitivity analysis for ordinal variables when specific categories of the ordinal variable are prone to missingness (Missing Not At Random).

Our sensitivity analysis containes three step

1. Performing MI under MAR

2. Modifying the imputed data to reflect plausible scenarios under MNAR

3. Analyzing the modified data and combining the results according to Rubinâ€™s rule.

<!-- badges: start -->
<!-- badges: end -->


# Installation

You can install the development version of ovsa from [GitHub](https://github.com/) with:

```
# install.packages("pak")
pak::pak("abdoulaye-dioni/ovsa")
```

```
# install.packages("devtools")  # Uncomment if you don't have devtools installed
devtools::install_github("abdoulaye-dioni/ovsa")
```



# Example


```{r example}
library(ovsa)
```


```{r}
data("simda") # non hierarchical data
head(simda)
```



Use the `simmnar` function from the `ovsa` package to simulate a Missing Not At Random (MNAR) mechanism in ordinal variables with specified probabilities for missing values.
 
```{r}
set.seed(321) # for reproducibility
simdaNA <- simmnar( data = simda, Y = "Y",  id = "id",
ord_var = "X1", A = 2,  probA = 0.5, B = 4,  probB = 0.8) # use simmnar
```


```{r}
head(simdaNA)
summary(simdaNA)
str(simdaNA)
```



Use the `firststep` function from the `ovsa` package to impute missing values in a non-hierarchical context. This function performs the first step of our sensitivity analysis for ordinal variables under a Missing Not At Random (MNAR) mechanism.

```{r}
imputed_mice <- firststep(simdaNA[, c("Y","X1.mis","X2")], mi = "mice",
method = c("logreg", "polr", "polyreg"), m = 10,printFlag = FALSE)
```



Use the `secondstep` function from the `ovsa` package to modifie imputed values in a non-hierarchical context. This function performs the second step of our sensitivity analysis for ordinal variables under a Missing Not At Random (MNAR) mechanism.

```{r}
library(mice)

summary(complete(imputed_mice,1))
formula <- "X1.mis.mar ~ Y + X2"
manydelta <- data.frame( delta1 = c(0,0,0,0), delta2 = c(0,-1,2,0),
delta3 = c(0,0.5,0,0.5), delta4 = c(-1,0.5,0,1))
level_ord_var = 5
seed = 123
```

```{r}
# Execution of the complete function
out <- secondstep(data = simdaNA, mardata = imputed_mice,
level_ord_var = level_ord_var, formula = formula, manydelta = manydelta,
seed = seed)
```

```{r}
summary(out$mnardata[[2]])
```


Use the `checkprop` function from the `ovsa` package to assess the plausibility of imputed data under the MAR mechanism and the modifications made under MNAR mechanisms.

```{r}
checkprop(data = out$mnardata, ord_mar = "X1.mis.mar",
ord_mis = "X1.mis", manydelta = manydelta)
```

